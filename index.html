<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>EEGAI Jobs - Tamil Nadu Employment Portal</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- PWA Meta Tags -->
<meta name="theme-color" content="#4f46e5">
<meta name="description" content="Tamil Nadu's Premier Employment Portal - Find jobs, hire talent, grow your career">
<link rel="manifest" href="manifest.json">
<link rel="apple-touch-icon" href="icon-192.png">

<!-- Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Noto+Sans+Tamil:wght@400;500;600;700&display=swap" rel="stylesheet">

<!-- External Libraries -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
:root{
  --primary:#4f46e5;
  --primary-dark:#4338ca;
  --secondary:#06b6d4;
  --accent:#f59e0b;
  --bg:#f8fafc;
  --card:#ffffff;
  --text:#0f172a;
  --muted:#64748b;
  --success:#22c55e;
  --danger:#ef4444;
  --warning:#f59e0b;
  --border:#e2e8f0;
  --shadow:0 4px 6px -1px rgba(0,0,0,0.1),0 2px 4px -1px rgba(0,0,0,0.06);
  --shadow-lg:0 20px 25px -5px rgba(0,0,0,0.1),0 10px 10px -5px rgba(0,0,0,0.04);
}

*{box-sizing:border-box;margin:0;padding:0}
body{
  margin:0;
  font-family:'Inter','Noto Sans Tamil',system-ui,sans-serif;
  background:linear-gradient(135deg,#eef2ff 0%,#f0fdfa 50%,#fdf4ff 100%);
  color:var(--text);
  min-height:100vh;
  line-height:1.6;
}

/* Header */
header{
  background:linear-gradient(90deg,var(--primary),var(--secondary));
  color:#fff;
  padding:16px 24px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  box-shadow:var(--shadow);
  position:sticky;
  top:0;
  z-index:100;
}
.logo{
  font-size:1.5rem;
  font-weight:700;
  display:flex;
  align-items:center;
  gap:10px;
}
.logo::before{
  content:"‚ö°";
  font-size:1.8rem;
}

/* Install PWA Button */
.install-pwa{
  display:none;
  background:rgba(255,255,255,0.2);
  border:2px solid #fff;
  color:#fff;
  padding:8px 16px;
  border-radius:8px;
  cursor:pointer;
  font-weight:600;
  transition:all 0.3s;
}
.install-pwa:hover{
  background:#fff;
  color:var(--primary);
}
.install-pwa.show{
  display:inline-block;
}

/* Buttons */
button{
  background:var(--primary);
  color:#fff;
  border:none;
  padding:12px 20px;
  border-radius:12px;
  cursor:pointer;
  font-weight:600;
  font-size:0.95rem;
  transition:all 0.3s ease;
  display:inline-flex;
  align-items:center;
  gap:8px;
}
button:hover{
  background:var(--primary-dark);
  transform:translateY(-2px);
  box-shadow:0 10px 20px -5px rgba(79,70,229,0.3);
}
button.secondary{background:var(--secondary)}
button.secondary:hover{background:#0891b2}
button.success{background:var(--success)}
button.danger{background:var(--danger)}
button.warning{background:var(--warning)}
button.ghost{
  background:transparent;
  color:var(--primary);
  border:2px solid var(--primary);
}
button.ghost:hover{
  background:var(--primary);
  color:#fff;
}
button:disabled{
  opacity:0.6;
  cursor:not-allowed;
  transform:none;
}

/* Action text colors */
.action-success{color:var(--success) !important;font-weight:600}
.action-danger{color:var(--danger) !important;font-weight:600}
.action-warning{color:var(--warning) !important;font-weight:600}
.action-primary{color:var(--primary) !important;font-weight:600}

/* Inputs */
input,select,textarea{
  width:100%;
  padding:12px 16px;
  margin:8px 0;
  border-radius:12px;
  border:2px solid var(--border);
  font-family:inherit;
  font-size:0.95rem;
  transition:all 0.3s ease;
  background:var(--card);
}
input:focus,select:focus,textarea:focus{
  outline:none;
  border-color:var(--primary);
  box-shadow:0 0 0 3px rgba(79,70,229,0.1);
}

/* Layout */
.container{
  max-width:1400px;
  margin:auto;
  padding:24px;
}

.card{
  background:var(--card);
  border-radius:20px;
  padding:24px;
  margin-bottom:24px;
  box-shadow:var(--shadow-lg);
  border:1px solid rgba(255,255,255,0.5);
  backdrop-filter:blur(10px);
}

/* Login */
.login-card{
  max-width:440px;
  margin:60px auto;
  text-align:center;
  padding:40px;
}
.login-card h2{
  font-size:2rem;
  margin-bottom:8px;
  background:linear-gradient(135deg,var(--primary),var(--secondary));
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
}
.login-card .subtitle{
  color:var(--muted);
  margin-bottom:32px;
  font-size:0.95rem;
}
.role-selector{
  display:flex;
  gap:12px;
  margin-bottom:24px;
  justify-content:center;
}
.role-btn{
  padding:10px 20px;
  border-radius:10px;
  border:2px solid var(--border);
  background:var(--card);
  color:var(--text);
  cursor:pointer;
  transition:all 0.3s;
  font-weight:500;
}
.role-btn.active{
  border-color:var(--primary);
  background:var(--primary);
  color:#fff;
}

/* Auth Toggle */
.auth-toggle{
  margin-top:20px;
  padding-top:20px;
  border-top:1px solid var(--border);
}
.auth-toggle p{
  color:var(--muted);
  margin-bottom:12px;
}

/* Dashboard */
.dashboard{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(260px,1fr));
  gap:20px;
  margin-bottom:24px;
}
.stat-card{
  background:linear-gradient(135deg,#fff 0%,#f8fafc 100%);
  border-radius:16px;
  padding:24px;
  border:1px solid var(--border);
  transition:transform 0.3s ease;
  position:relative;
  overflow:hidden;
  cursor:pointer;
}
.stat-card::before{
  content:"";
  position:absolute;
  top:0;
  left:0;
  width:100%;
  height:4px;
  background:linear-gradient(90deg,var(--primary),var(--secondary));
}
.stat-card:hover{
  transform:translateY(-4px);
  box-shadow:var(--shadow-lg);
}
.stat-card h3{
  font-size:0.875rem;
  color:var(--muted);
  text-transform:uppercase;
  letter-spacing:0.05em;
  margin-bottom:8px;
}
.stat-card .value{
  font-size:2.5rem;
  font-weight:700;
  color:var(--text);
  margin-bottom:4px;
}
.stat-card .change{
  font-size:0.875rem;
  color:var(--success);
  font-weight:500;
}

/* Avatar & Profile */
.avatar{
  width:64px;
  height:64px;
  border-radius:50%;
  background:linear-gradient(135deg,var(--primary),var(--secondary));
  display:flex;
  align-items:center;
  justify-content:center;
  color:#fff;
  font-size:28px;
  font-weight:600;
  box-shadow:0 4px 12px rgba(79,70,229,0.3);
}
.avatar-small{
  width:40px;
  height:40px;
  font-size:18px;
}
.profile-header{
  display:flex;
  gap:20px;
  align-items:center;
  margin-bottom:24px;
}

/* Tables */
.table-container{
  overflow-x:auto;
  border-radius:12px;
  border:1px solid var(--border);
  margin-top:16px;
}
table{
  width:100%;
  border-collapse:collapse;
  background:var(--card);
}
th,td{
  padding:16px;
  text-align:left;
  border-bottom:1px solid var(--border);
}
th{
  background:#f8fafc;
  font-weight:600;
  font-size:0.875rem;
  color:var(--muted);
  text-transform:uppercase;
  letter-spacing:0.05em;
}
tr:hover{
  background:#f8fafc;
}
.badge{
  display:inline-flex;
  align-items:center;
  padding:6px 12px;
  border-radius:20px;
  font-size:0.75rem;
  font-weight:600;
  text-transform:uppercase;
}
.badge-success{background:#dcfce7;color:#166534}
.badge-warning{background:#fef3c7;color:#92400e}
.badge-danger{background:#fee2e2;color:#991b1b}
.badge-info{background:#dbeafe;color:#1e40af}
.badge-inactive{background:#f3f4f6;color:#374151}

/* Job Cards */
.job-grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(350px,1fr));
  gap:20px;
}
.job-card{
  background:var(--card);
  border-radius:16px;
  padding:24px;
  border:1px solid var(--border);
  transition:all 0.3s ease;
  cursor:pointer;
}
.job-card:hover{
  transform:translateY(-4px);
  box-shadow:var(--shadow-lg);
  border-color:var(--primary);
}
.job-card .company{
  display:flex;
  align-items:center;
  gap:12px;
  margin-bottom:16px;
}
.job-card h4{
  font-size:1.125rem;
  margin-bottom:8px;
  color:var(--text);
}
.job-card .meta{
  display:flex;
  gap:16px;
  color:var(--muted);
  font-size:0.875rem;
  margin-bottom:16px;
  flex-wrap:wrap;
}
.job-card .tags{
  display:flex;
  gap:8px;
  flex-wrap:wrap;
  margin-bottom:16px;
}
.tag{
  background:#f1f5f9;
  padding:4px 12px;
  border-radius:20px;
  font-size:0.75rem;
  color:var(--muted);
}

/* Modal */
.modal-overlay{
  position:fixed;
  top:0;
  left:0;
  width:100%;
  height:100%;
  background:rgba(0,0,0,0.5);
  backdrop-filter:blur(4px);
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:1000;
  opacity:0;
  visibility:hidden;
  transition:all 0.3s;
  overflow-y:auto;
  padding:20px;
}
.modal-overlay.active{
  opacity:1;
  visibility:visible;
}
.modal{
  background:var(--card);
  border-radius:20px;
  padding:32px;
  max-width:800px;
  width:100%;
  max-height:90vh;
  overflow-y:auto;
  transform:scale(0.9);
  transition:transform 0.3s;
}
.modal-overlay.active .modal{
  transform:scale(1);
}
.modal-header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:24px;
}
.close-btn{
  background:none;
  border:none;
  font-size:1.5rem;
  cursor:pointer;
  color:var(--muted);
  padding:0;
  width:40px;
  height:40px;
  display:flex;
  align-items:center;
  justify-content:center;
  border-radius:50%;
}
.close-btn:hover{
  background:#f1f5f9;
  color:var(--text);
}

/* Tabs */
.tabs{
  display:flex;
  gap:8px;
  margin-bottom:24px;
  border-bottom:2px solid var(--border);
  padding-bottom:0;
  overflow-x:auto;
}
.tab{
  padding:12px 20px;
  background:none;
  border:none;
  color:var(--muted);
  font-weight:600;
  cursor:pointer;
  border-bottom:2px solid transparent;
  margin-bottom:-2px;
  transition:all 0.3s;
  white-space:nowrap;
}
.tab.active{
  color:var(--primary);
  border-bottom-color:var(--primary);
}

/* Skills Input */
.skills-container{
  display:flex;
  flex-wrap:wrap;
  gap:8px;
  margin-top:8px;
  padding:8px;
  border:2px solid var(--border);
  border-radius:12px;
  min-height:50px;
}
.skill-tag{
  background:linear-gradient(135deg,var(--primary),var(--secondary));
  color:#fff;
  padding:6px 12px;
  border-radius:20px;
  font-size:0.875rem;
  display:flex;
  align-items:center;
  gap:6px;
}
.skill-tag button{
  background:none;
  border:none;
  color:#fff;
  cursor:pointer;
  padding:0;
  font-size:1rem;
  line-height:1;
}

/* Filters */
.filter-bar{
  display:flex;
  gap:12px;
  margin-bottom:24px;
  flex-wrap:wrap;
  align-items:end;
}
.filter-bar input, .filter-bar select{
  margin:0;
  flex:1;
  min-width:200px;
}

/* Share Buttons */
.share-btns{
  display:flex;
  gap:12px;
  margin-top:16px;
}
.share-btn{
  flex:1;
  padding:12px;
  border-radius:12px;
  border:none;
  cursor:pointer;
  font-weight:600;
  display:flex;
  align-items:center;
  justify-content:center;
  gap:8px;
  transition:all 0.3s;
}
.share-btn.whatsapp{background:#25d366;color:#fff}
.share-btn.call{background:var(--success);color:#fff}
.share-btn:hover{
  transform:translateY(-2px);
  box-shadow:0 4px 12px rgba(0,0,0,0.15);
}

/* CSV Upload */
.upload-area{
  border:2px dashed var(--border);
  border-radius:16px;
  padding:40px;
  text-align:center;
  cursor:pointer;
  transition:all 0.3s;
}
.upload-area:hover{
  border-color:var(--primary);
  background:#f8fafc;
}
.upload-area input{
  display:none;
}

/* UPI Display */
.upi-display{
  background:linear-gradient(135deg,#f0fdf4,#dcfce7);
  border:2px solid var(--success);
  border-radius:16px;
  padding:24px;
  text-align:center;
  margin:20px 0;
}
.upi-id{
  font-size:1.5rem;
  font-weight:700;
  color:var(--success);
  letter-spacing:1px;
  margin:12px 0;
}

/* Poster Gallery */
.poster-gallery{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(200px,1fr));
  gap:16px;
  margin:20px 0;
}
.poster-item{
  position:relative;
  border-radius:12px;
  overflow:hidden;
  box-shadow:var(--shadow);
}
.poster-item img{
  width:100%;
  height:150px;
  object-fit:cover;
}
.poster-item .actions{
  position:absolute;
  top:8px;
  right:8px;
  display:flex;
  gap:8px;
}
.poster-item .actions button{
  padding:6px;
  font-size:0.875rem;
}

/* Utilities */
.hidden{display:none !important}
.muted{color:var(--muted)}
.success{color:var(--success)}
.danger{color:var(--danger)}
.flex{display:flex}
.items-center{align-items:center}
.justify-between{justify-content:space-between}
.gap-2{gap:8px}
.gap-4{gap:16px}
.mb-4{margin-bottom:16px}
.mt-4{margin-top:16px}
.text-sm{font-size:0.875rem}
.font-semibold{font-weight:600}
.text-center{text-align:center}

/* Animations */
@keyframes slideIn{
  from{opacity:0;transform:translateY(20px)}
  to{opacity:1;transform:translateY(0)}
}
.animate-in{
  animation:slideIn 0.5s ease-out;
}

/* Toast */
.toast{
  position:fixed;
  bottom:24px;
  right:24px;
  background:var(--text);
  color:#fff;
  padding:16px 24px;
  border-radius:12px;
  box-shadow:var(--shadow-lg);
  display:flex;
  align-items:center;
  gap:12px;
  transform:translateX(400px);
  transition:transform 0.3s ease;
  z-index:1001;
}
.toast.show{
  transform:translateX(0);
}
.toast.success{background:var(--success)}
.toast.error{background:var(--danger)}

/* CSV Format Box */
.csv-format-box{
  background:#f8fafc;
  border:1px solid var(--border);
  border-radius:12px;
  padding:16px;
  margin:16px 0;
  font-family:monospace;
  font-size:0.875rem;
  overflow-x:auto;
}
.csv-format-box code{
  color:var(--primary);
  font-weight:600;
}

/* Responsive */
@media(max-width:768px){
  .dashboard{grid-template-columns:1fr}
  .job-grid{grid-template-columns:1fr}
  .profile-header{flex-direction:column;text-align:center}
  .tabs{overflow-x:auto}
  .filter-bar{flex-direction:column}
  .filter-bar input, .filter-bar select{width:100%}
  .poster-gallery{grid-template-columns:repeat(2,1fr)}
}
</style>
</head>

<body>

<header>
  <div class="logo">EEGAI Jobs</div>
  <div style="display:flex;gap:12px;align-items:center">
    <button id="installPWABtn" class="install-pwa" onclick="installPWA()">üì± Install App</button>
    <span id="userDisplay" class="hidden" style="font-weight:500"></span>
    <button id="logoutBtn" class="hidden secondary" onclick="logout()">Logout</button>
  </div>
</header>

<div class="container">

<!-- LOGIN VIEW -->
<div id="loginView" class="card login-card animate-in">
  <h2>Welcome Back</h2>
  <p class="subtitle">Tamil Nadu's Premier Employment Portal</p>
  
  <div class="role-selector">
    <div class="role-btn active" onclick="selectRole('employee')">üë§ Employee</div>
    <div class="role-btn" onclick="selectRole('employer')">üè¢ Employer</div>
    <div class="role-btn" onclick="selectRole('admin')">üëë Admin</div>
  </div>

  <input id="loginUser" placeholder="Username / Email" autocomplete="username">
  <input id="loginPass" type="password" placeholder="Password" autocomplete="current-password">
  
  <button onclick="login()" style="width:100%;margin-top:16px">
    Sign In ‚Üí
  </button>

  <div class="auth-toggle">
    <p class="muted">Demo Logins:</p>
    <p class="text-sm">Employee: ravi@emp / 123</p>
    <p class="text-sm">Employer: abc@employer / 123</p>
    <p class="text-sm">Admin: admin@eegai / Admin@123</p>
  </div>
</div>

<!-- EMPLOYEE VIEW -->
<div id="employeeView" class="hidden animate-in">
  <div class="card">
    <h2>Browse Jobs</h2>
    <div class="filter-bar">
      <input type="text" id="jobSearch" placeholder="Search jobs, companies..." onkeyup="searchJobs()">
    </div>
    
    <div class="job-grid" id="jobListings"></div>
  </div>
</div>

<!-- EMPLOYER VIEW -->
<div id="employerView" class="hidden animate-in">
  <div class="card">
    <h2 id="employerName">My Company</h2>
    <p class="muted mb-4">Manage your job postings</p>
    <button onclick="openPostJobModal()">+ Post New Job</button>
    <div id="employerJobsList" style="margin-top:24px"></div>
  </div>
</div>

<!-- ADMIN VIEW -->
<div id="adminView" class="hidden animate-in">
  <div class="card">
    <h2>Admin Dashboard</h2>
    <div class="dashboard">
      <div class="stat-card">
        <h3>Total Users</h3>
        <div class="value" id="totalUsers">0</div>
      </div>
      <div class="stat-card">
        <h3>Active Jobs</h3>
        <div class="value" id="totalJobs">0</div>
      </div>
    </div>
  </div>
</div>

<!-- JOB DETAILS MODAL -->
<div id="jobDetailsModal" class="modal-overlay" onclick="closeModal(event)">
  <div class="modal" onclick="event.stopPropagation()">
    <div class="modal-header">
      <h3 id="detailJobTitle">Job Details</h3>
      <button class="close-btn" onclick="closeJobDetailsModal()">√ó</button>
    </div>
    <div id="jobDetailsContent"></div>
    <button onclick="applyJob()" style="width:100%;margin-top:20px">
      Apply for this Job
    </button>
  </div>
</div>

<!-- POST JOB MODAL -->
<div id="postJobModal" class="modal-overlay" onclick="closeModal(event)">
  <div class="modal" onclick="event.stopPropagation()">
    <div class="modal-header">
      <h3>Post New Job</h3>
      <button class="close-btn" onclick="closePostJobModal()">√ó</button>
    </div>
    <form id="postJobForm" onsubmit="submitJob(event)">
      <input id="jobTitle" placeholder="Job Title *" required>
      <textarea id="jobDescription" rows="4" placeholder="Job Description *" required></textarea>
      <input id="jobLocation" placeholder="Location *" required>
      <input id="jobSalary" placeholder="Salary Range *" required>
      <button type="submit" style="width:100%;margin-top:16px">Post Job</button>
    </form>
  </div>
</div>

<!-- TOAST -->
<div id="toast" class="toast">
  <span id="toastIcon">‚úì</span>
  <span id="toastMessage">Operation successful</span>
</div>

</div>

<script>
// PWA Service Worker Registration
if('serviceWorker' in navigator) {
  navigator.serviceWorker.register('/sw.js')
    .then(() => console.log('Service Worker registered'))
    .catch(err => console.error('SW registration failed:', err));
}

// PWA Install Prompt
let deferredPrompt;
window.addEventListener('beforeinstallprompt', (e) => {
  e.preventDefault();
  deferredPrompt = e;
  document.getElementById('installPWABtn').classList.add('show');
});

async function installPWA() {
  if(!deferredPrompt) {
    showToast('App is already installed or not available', 'error');
    return;
  }
  deferredPrompt.prompt();
  const { outcome } = await deferredPrompt.userChoice;
  deferredPrompt = null;
  if(outcome === 'accepted') {
    showToast('App installed successfully!', 'success');
    document.getElementById('installPWABtn').classList.remove('show');
  }
}

// DATA
const ADMIN = { username:"admin@eegai", password:"Admin@123", role:"admin", name:"System Admin" };

let users = [
  { id:1, username:"ravi@emp", password:"123", role:"employee", name:"Ravi Kumar", email:"ravi@email.com", phone:"9876543210" },
  { id:2, username:"abc@employer", password:"123", role:"employer", companyName:"ABC Technologies", email:"abc@company.com", phone:"9876543212", credits:10 }
];

let jobs = [
  { id:1, title:"Software Developer", company:"ABC Technologies", location:"Chennai", salary:"‚Çπ5-8 LPA", description:"Looking for experienced developer", status:"active", postedBy:2 },
  { id:2, title:"Marketing Manager", company:"Brand Inc", location:"Coimbatore", salary:"‚Çπ6-10 LPA", description:"Manage marketing campaigns", status:"active", postedBy:2 }
];

const session = { user:null };

// AUTHENTICATION
function selectRole(role) {
  document.querySelectorAll('.role-btn').forEach(btn => btn.classList.remove('active'));
  event.target.classList.add('active');
}

function login() {
  const u = document.getElementById('loginUser').value.trim();
  const p = document.getElementById('loginPass').value.trim();

  if (u === ADMIN.username && p === ADMIN.password) {
    session.user = ADMIN;
    showToast('Welcome back, Administrator!', 'success');
    showView('adminView');
    initAdminDashboard();
    return;
  }

  const user = users.find(x => x.username === u && x.password === p);
  if (!user) {
    showToast('Invalid credentials', 'error');
    return;
  }

  session.user = user;
  showToast(`Welcome, ${user.name || user.companyName}!`, 'success');

  if (user.role === "employee") {
    showView('employeeView');
    renderJobListings();
  } else {
    document.getElementById('employerName').textContent = user.companyName;
    showView('employerView');
    renderEmployerJobs();
  }
}

function logout() {
  session.user = null;
  showView('loginView');
  showToast('Logged out successfully', 'success');
}

function showView(viewId) {
  ['loginView','employeeView','employerView','adminView'].forEach(id => {
    document.getElementById(id).classList.add('hidden');
  });
  document.getElementById(viewId).classList.remove('hidden');
  
  const logoutBtn = document.getElementById('logoutBtn');
  const userDisplay = document.getElementById('userDisplay');
  
  if(viewId === 'loginView') {
    logoutBtn.classList.add('hidden');
    userDisplay.classList.add('hidden');
  } else {
    logoutBtn.classList.remove('hidden');
    userDisplay.classList.remove('hidden');
    userDisplay.textContent = session.user?.name || session.user?.companyName || 'Admin';
  }
}

// EMPLOYEE FUNCTIONS
function renderJobListings() {
  const container = document.getElementById('jobListings');
  const activeJobs = jobs.filter(j => j.status === 'active');
  
  container.innerHTML = activeJobs.map(job => `
    <div class="job-card" onclick="showJobDetails(${job.id})">
      <div class="company">
        <div class="avatar avatar-small">${job.company.charAt(0)}</div>
        <div>
          <div class="font-semibold">${job.company}</div>
          <div class="text-sm muted">${job.location}</div>
        </div>
      </div>
      <h4>${job.title}</h4>
      <div class="meta">
        <span>üìç ${job.location}</span>
        <span>üí∞ ${job.salary}</span>
      </div>
      <p class="text-sm muted" style="margin:12px 0">${job.description}</p>
      <button onclick="event.stopPropagation();applyJob(${job.id})" style="width:100%">Apply Now</button>
    </div>
  `).join('');
}

function searchJobs() {
  const search = document.getElementById('jobSearch').value.toLowerCase();
  const filtered = jobs.filter(j => {
    return j.status === 'active' && (
      j.title.toLowerCase().includes(search) ||
      j.company.toLowerCase().includes(search) ||
      j.location.toLowerCase().includes(search)
    );
  });
  
  const container = document.getElementById('jobListings');
  container.innerHTML = filtered.map(job => `
    <div class="job-card" onclick="showJobDetails(${job.id})">
      <div class="company">
        <div class="avatar avatar-small">${job.company.charAt(0)}</div>
        <div>
          <div class="font-semibold">${job.company}</div>
          <div class="text-sm muted">${job.location}</div>
        </div>
      </div>
      <h4>${job.title}</h4>
      <div class="meta">
        <span>üìç ${job.location}</span>
        <span>üí∞ ${job.salary}</span>
      </div>
      <p class="text-sm muted" style="margin:12px 0">${job.description}</p>
      <button onclick="event.stopPropagation();applyJob(${job.id})" style="width:100%">Apply Now</button>
    </div>
  `).join('');
}

function showJobDetails(jobId) {
  const job = jobs.find(j => j.id === jobId);
  if(!job) return;
  
  document.getElementById('detailJobTitle').textContent = job.title;
  document.getElementById('jobDetailsContent').innerHTML = `
    <h3>${job.company}</h3>
    <p class="muted mb-4">${job.location}</p>
    
    <div style="background:#f8fafc;padding:16px;border-radius:12px;margin:16px 0">
      <p><strong>üí∞ Salary:</strong> ${job.salary}</p>
      <p style="margin-top:8px"><strong>üìç Location:</strong> ${job.location}</p>
    </div>
    
    <h4>Job Description</h4>
    <p style="color:var(--muted);margin-top:8px">${job.description}</p>
  `;
  
  document.getElementById('jobDetailsModal').dataset.jobId = jobId;
  document.getElementById('jobDetailsModal').classList.add('active');
}

function closeJobDetailsModal() {
  document.getElementById('jobDetailsModal').classList.remove('active');
}

function applyJob(jobIdParam) {
  const jobId = jobIdParam || parseInt(document.getElementById('jobDetailsModal').dataset.jobId);
  showToast('Application submitted successfully!', 'success');
  closeJobDetailsModal();
}

// EMPLOYER FUNCTIONS
function renderEmployerJobs() {
  const container = document.getElementById('employerJobsList');
  const myJobs = jobs.filter(j => j.postedBy === session.user.id);
  
  if(myJobs.length === 0) {
    container.innerHTML = '<p class="muted">No jobs posted yet. Click "Post New Job" to get started!</p>';
    return;
  }
  
  container.innerHTML = myJobs.map(job => `
    <div class="job-card" style="margin-bottom:16px">
      <h4>${job.title}</h4>
      <p class="muted">${job.location} ‚Ä¢ ${job.salary}</p>
      <p class="text-sm muted" style="margin:12px 0">${job.description}</p>
      <span class="badge badge-${job.status === 'active' ? 'success' : 'warning'}">${job.status}</span>
    </div>
  `).join('');
}

function openPostJobModal() {
  if(session.user.credits <= 0) {
    showToast('Insufficient credits! Please contact support.', 'error');
    return;
  }
  document.getElementById('postJobModal').classList.add('active');
}

function closePostJobModal() {
  document.getElementById('postJobModal').classList.remove('active');
}

function submitJob(e) {
  e.preventDefault();
  
  const newJob = {
    id: jobs.length + 1,
    title: document.getElementById('jobTitle').value,
    company: session.user.companyName,
    description: document.getElementById('jobDescription').value,
    location: document.getElementById('jobLocation').value,
    salary: document.getElementById('jobSalary').value,
    status: 'active',
    postedBy: session.user.id
  };
  
  jobs.push(newJob);
  session.user.credits--;
  
  saveToLocalStorage();
  closePostJobModal();
  showToast('Job posted successfully!', 'success');
  renderEmployerJobs();
}

// ADMIN FUNCTIONS
function initAdminDashboard() {
  document.getElementById('totalUsers').textContent = users.length;
  document.getElementById('totalJobs').textContent = jobs.length;
}

// UTILITIES
function showToast(message, type='success') {
  const toast = document.getElementById('toast');
  const icon = document.getElementById('toastIcon');
  const msg = document.getElementById('toastMessage');
  
  toast.className = `toast ${type}`;
  icon.textContent = type === 'success' ? '‚úì' : '‚úï';
  msg.textContent = message;
  
  toast.classList.add('show');
  setTimeout(() => toast.classList.remove('show'), 3000);
}

function closeModal(event) {
  if(event.target === event.currentTarget) {
    event.target.classList.remove('active');
  }
}

// LOCAL STORAGE
function saveToLocalStorage() {
  try {
    localStorage.setItem('eegai_users', JSON.stringify(users));
    localStorage.setItem('eegai_jobs', JSON.stringify(jobs));
  } catch(e) {
    console.error('Error saving to localStorage:', e);
  }
}

function loadFromLocalStorage() {
  try {
    const savedUsers = localStorage.getItem('eegai_users');
    const savedJobs = localStorage.getItem('eegai_jobs');
    
    if(savedUsers) users = JSON.parse(savedUsers);
    if(savedJobs) jobs = JSON.parse(savedJobs);
  } catch(e) {
    console.error('Error loading from localStorage:', e);
  }
}

// INITIALIZATION
document.addEventListener('DOMContentLoaded', () => {
  loadFromLocalStorage();
  document.getElementById('loginPass').addEventListener('keypress', (e) => {
    if(e.key === 'Enter') login();
  });
});
</script>

</body>
</html>
